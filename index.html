<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Neon Strike - MULTI PLAYROOM</title>
    <script src="https://unpkg.com/playroomkit/multiplayer.js"></script>
    <style>
        html, body { margin: 0; height: 100%; overflow: hidden; background: #000; font-family: sans-serif; }
        canvas { display: block; }
        .ui-overlay {
            position: absolute; top: 20px; left: 20px; z-index: 10;
            color: #fff; background: rgba(0,0,0,0.7); padding: 15px;
            border-radius: 10px; border: 1px solid #00d4ff; pointer-events: none;
        }
        #weaponHUD {
            position: absolute; bottom: 20px; right: 20px; color: #ffdd33;
            background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px;
            border: 2px solid #ffdd33; font-weight: bold; font-size: 18px;
        }
    </style>
</head>
<body>

<div class="ui-overlay">
    <div id="status">Connexion au salon...</div>
    <div id="playerList">Joueurs: 1/10</div>
    <div id="scoreHUD">Points: 0</div>
</div>

<div id="weaponHUD">PISTOLET</div>

<script type="module">
// On importe TOUT ici, comme ça pas d'erreur de définition
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.module.js";
import { 
    insertCoin, 
    myPlayer, 
    onPlayerJoin, 
    isHost,
    getState,
    setState
} from "https://unpkg.com/playroomkit@0.0.82/multiplayer.js"; 

// Maintenant, plus besoin de faire "const { ... } = Playroom;"
// Les fonctions sont déjà prêtes !

let scene, camera, renderer, yaw = 0;
let players = []; 
let playerMeshes = {}; 
let keys = {};

// ... Le reste du code reste le même ...

async function start() {
    try {
        await insertCoin({
            gameId: "neon-strike-v7",
            maxPlayersPerRoom: 10,
        });
        setupScene();
        
        onPlayerJoin((state) => {
            console.log("Nouveau joueur :", state.id);
            const color = state.getProfile().color.hex;
            const group = new THREE.Group();
            buildPlayerMesh(group, state.getCustomProperty("skin") || "default", color);
            scene.add(group);
            playerMeshes[state.id] = group;
            players.push(state);

            state.onQuit(() => {
                scene.remove(playerMeshes[state.id]);
                delete playerMeshes[state.id];
            });
        });

        setupEvents();
        loop();
    } catch (e) {
        console.error("Erreur Playroom:", e);
    }
}

// Relance le jeu
start();
</script>
</body>
</html>

